import{r as t,h as s,H as e}from"./p-d36a7c4b.js";const i=class{constructor(s){t(this,s),this.highlightSelectedRow=!1,this.multiExpandable=!1,this.multiSelectable=!1,this.loadedData=!1,this.sortedMap={},this.filteredMap={}}connectedCallback(){this.columns||(this.columns=JSON.parse(this.columnsString))}componentWillLoad(){this.dataList?(this.fullDataList=this.dataList,this.currentDataList=this.dataList,this.loadedData=!0):this.getTableDataFromUrl()}componentDidLoad(){this.columns.map((t=>{t&&t.filterable&&("select"===t.filterType||"datalist"===t.filterType)&&document.addEventListener(`ed-smartlist[${t.field}Filter]:smartListItemSelected`,(async s=>{this.applyFilter(s.detail.value,t.field)}))}))}updateDataList(t){console.log("detected dataList change - updated (again) fullDataList to size "+t.length),this.fullDataList=t,this.reconstructDataList()}getTableDataFromUrl(){fetch(this.url,{method:"GET",headers:{"Content-Type":"application/json","sso-token":this.ssoToken}}).then((t=>t.json())).then((t=>{this.fullDataList=t[this.locator],this.currentDataList=t[this.locator],this.loadedData=!0}))}sortTableBy(t){var s=this.sortedMap[t],e=!0;s&&s.isAssending&&(e=!1),this.sortedMap={},this.sortedMap[t]={isAssending:e},this.applySorting(t)}applySorting(t){var s;this.sortedField=t;var e=!1;this.sortedMap[t]&&this.sortedMap[t].isAssending&&(e=!0),s=this.currentDataList.sort(e?(s,e)=>isNaN(s)&&isNaN(e)?s[t]>e[t]?1:-1:s[t]-e[t]:(s,e)=>isNaN(e)&&isNaN(s)?e[t]>s[t]?1:-1:e[t]-s[t]),this.currentDataList=[...s]}getSortIndictorClass(t){return t&&t.isAssending?"sort-asc":t&&!t.isAssending?"sort-desc":""}reconstructDataList(){this.currentDataList=[...this.fullDataList],Object.keys(this.filteredMap).forEach((t=>{var s=this.filteredMap[t];s&&s.value&&this.applyFilter(s.value,t)})),this.sortedField&&this.applySorting(this.sortedField)}applyFilterEvent(t,s){this.applyFilter(t.target.value,s)}applyFilter(t,s){this.filteredMap[s]={},this.reconstructDataList();var e=this.currentDataList.filter((e=>!(!e||!e[s])&&e[s].toUpperCase().includes(t.toUpperCase())));this.currentDataList=[...e],this.filteredMap[s]={value:t}}gotAllFieldValues(t){var s=[];return this.fullDataList&&(this.fullDataList.map((e=>{s.push(e[t.field])})),s=[...new Set(s)].sort()),s}handleSelect(){console.log("successfully detected selection!")}areAllRowSelected(){var t=!0;return this.currentDataList.map((s=>{t&&!s.rowSelection&&(t=!1)})),t}toggleSelectAllOrNone(){this.areAllRowSelected()?this.clearAllRowSelection():this.selectAllRowSelection(),this.currentDataList=[...this.currentDataList]}renderFilter(t){if(t&&t.filterable){if("select"===t.filterType||"datalist"===t.filterType){var e=this.gotAllFieldValues(t);return s("ed-smartlist",{"list-id":t.field+"Filter",list:e,listType:t.filterType})}if("selectAllOrNoneCheckbox"===t.filterType){var i=this.areAllRowSelected();return s("div",{class:"checkbox"},s("label",{onClick:t=>t.stopPropagation()},s("input",{type:"checkbox",checked:i,onClick:()=>this.toggleSelectAllOrNone()}),s("i",{class:"helper"}),s("ed-icon-button",{buttonId:"toggleSelectionButton",icon:"icons8-exchange",buttonTitle:"Toggle selection",onClick:t=>this.toggleAllRowSelection(t)})))}return s("div",null,s("input",{type:"text",onKeyUp:s=>this.applyFilterEvent(s,t.field)}))}}renderColumnHeading(t){var e={flex:"1"};if(t.flex&&(e.flex=t.flex),t.sortable){var i=this.getSortIndictorClass(this.sortedMap[t.field]);return s("th",{style:e,class:"sortable "+i},s("div",{onClick:()=>this.sortTableBy(t.field)},s("span",{class:"sort-indicator"},t.label)),this.renderFilter(t))}return s("th",{style:e},s("span",null,t.label),this.renderFilter(t))}renderCell(t,s){return s?s(t):t}renderCellData(t,e,i){var l={flex:"1","text-align":"center"};return i.flex&&(l.flex=i.flex),i.textAlign&&(l["text-align"]=i.textAlign),0===t?s("th",{scope:"row",style:l},this.renderCell(e,i.customRender)):s("td",{style:l},this.renderCell(e,i.renderFunction))}getFilterableClass(t){return t.filter((t=>t.filterable)).length>0?"filters":""}clearAllRowSelection(){this.currentDataList.map((t=>{t.rowSelection=!1}))}selectAllRowSelection(){this.currentDataList.map((t=>{t.rowSelection=!0}))}toggleAllRowSelection(t){t.stopPropagation(),this.currentDataList.map((t=>{t.rowSelection=!t.rowSelection})),this.currentDataList=[...this.currentDataList]}toggleRowSelection(t){var s=this.currentDataList[t].rowSelection;this.multiSelectable||this.clearAllRowSelection(),this.currentDataList[t].rowSelection=!s}clearAllRowExpanded(){this.currentDataList.map((t=>{t.rowExpanded=!1}))}toggleRowExpanded(t){var s=this.currentDataList[t].rowExpanded;this.multiExpandable||this.clearAllRowExpanded(),this.currentDataList[t].rowExpanded=!s}onRowClick(t){console.log("got clicked row "+t),this.toggleRowSelection(t),this.toggleRowExpanded(t),this.currentDataList=[...this.currentDataList]}getRowSelectionClass(t){return this.highlightSelectedRow&&this.currentDataList[t].rowSelection?"selected-row":""}renderRow(t,e){var i=this.renderExpandedRow(t,e);return[s("tr",{class:""+this.getRowSelectionClass(e),onClick:()=>this.onRowClick(e)},this.columns.map(((s,e)=>this.renderCellData(e,t[s.field],s)))),i]}renderExpandedRow(t,s){if(t.rowExpanded&&"function"==typeof this.customExpandedRowRender)return this.customExpandedRowRender(t,s)}render(){if(this.currentDataList)return s(e,null,s("table",{class:"table otpp-table actionable ng-table"},s("caption",{class:"sr-only"}),s("thead",{class:"header"},s("tr",{class:"ng-table-sort-header "+this.getFilterableClass(this.columns)},this.columns.map((t=>this.renderColumnHeading(t))))),s("tbody",null,this.currentDataList.map(((t,s)=>this.renderRow(t,s))))))}static get watchers(){return{dataList:["updateDataList"]}}};export{i as ed_table}